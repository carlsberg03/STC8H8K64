C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE SEEKFREE_OLED
OBJECT MODULE PLACED IN .\Out_File\SEEKFREE_OLED.obj
COMPILER INVOKED BY: D:\Keil\Keil_5\C51\BIN\C51.EXE ..\..\Libraries\seekfree_peripheral\SEEKFREE_OLED.c LARGE OMF2 OPTIM
                    -IZE(8,SPEED) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_periphe
                    -ral;..\USER\inc;..\USER\src;..\CODE) DEBUG PRINT(.\Out_File\SEEKFREE_OLED.lst) TABS(2) OBJECT(.\Out_File\SEEKFREE_OLED.o
                    -bj)

line level    source

   1          /*********************************************************************************************************
             -************
   2           * COPYRIGHT NOTICE
   3           * Copyright (c) 2018,逐飞科技
   4           * All rights reserved.
   5           * 技术讨论QQ群：一群：179029047(已满)  二群：244861897
   6           *
   7           * 以下所有内容版权均属逐飞科技所有，未经允许不得用于商业用途，
   8           * 欢迎各位使用并传播本程序，修改内容时必须保留逐飞科技的版权声明。
   9           *
  10           * @file          OLED
  11           * @company       成都逐飞科技有限公司
  12           * @author        逐飞科技(QQ3184284598)
  13           * @version       查看doc内version文件 版本说明
  14           * @Software    MDK FOR C51 V9.60
  15           * @Taobao      https://seekfree.taobao.com/
  16           * @date          2019-04-30
  17           * @note    
  18                    接线定义：
  19                    ------------------------------------ 
  20                        OLED液晶    单片机                        
  21                        D0          查看SEEKFREE_OLED文件内的OLED_SCL_PIN   宏定义
  22                        D1          查看SEEKFREE_OLED文件内的OLED_SDA_PIN   宏定义            
  23                        RES         查看SEEKFREE_OLED文件内的OLED_RST_PIN   宏定义    
  24                        DC          查看SEEKFREE_OLED文件内的OLED_DC_PIN    宏定义
  25                      CS          查看SEEKFREE_OLED文件内的OLED_CS_PIN    宏定义
  26                    ------------------------------------ 
  27           *********************************************************************************************************
             -***********/
  28          
  29          #include "zf_spi.h"
  30          #include "zf_delay.h"
  31          #include "SEEKFREE_FONT.h"
  32          #include "SEEKFREE_PRINTF.h"
  33          #include "SEEKFREE_OLED.h"
  34          
  35          //--------------------------------------------------------------------------------------------------------
             ------------
  36          //  以下函数是使用软件SPI通信，相比较硬件SPI，软件SPI引脚更加灵活，可以使用任意普通IO
  37          //--------------------------------------------------------------------------------------------------------
             ------------
  38          
  39          //--------------------------------------------------------------------------------------------------------
             ------------
  40          //  @brief      内部调用，用户无需关心
  41          //  @param      void        
  42          //  @return             
  43          //  @since      v1.0
  44          //  Sample usage:               
  45          //--------------------------------------------------------------------------------------------------------
             ------------
  46          void oled_wrdat(uint8 dat)
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 2   

  47          {
  48   1        uint8 i=8;
  49   1        
  50   1          OLED_CS(0); //使能信号端，拉低时正常使用
  51   1        OLED_DC(1);
  52   1        OLED_SCL(0);
  53   1        while(i--)
  54   1        {
  55   2            if(dat&0x80){OLED_SDA(1);}
  56   2            else{OLED_SDA(0);}
  57   2            OLED_SCL(1);
  58   2          
  59   2            OLED_SCL(0);
  60   2            dat<<=1;
  61   2        }
  62   1          OLED_CS(1); //使能信号端，拉低时正常使用
  63   1      }
  64          
  65          //--------------------------------------------------------------------------------------------------------
             ------------
  66          //  @brief      内部调用，用户无需关心
  67          //  @param      void        
  68          //  @return             
  69          //  @since      v1.0
  70          //  Sample usage:               
  71          //--------------------------------------------------------------------------------------------------------
             ------------
  72          //void oled_wr6dat(uint8 dat)
  73          //{
  74          //  uint8 i=6;
  75          //    
  76          //  OLED_CS(0); //使能信号端，拉低时正常使用
  77          //  OLED_DC(1);
  78          //  OLED_SCL(0);
  79          //  while(i--)
  80          //  {
  81          //    if(dat&0x80){OLED_SDA(1);}
  82          //    else{OLED_SDA(0);}
  83          //    OLED_SCL(1);
  84          //    OLED_SCL(0);
  85          //    dat<<=1;
  86          //  }
  87          //    OLED_CS(1); //使能信号端，拉低时正常使用
  88          //}
  89          
  90          //--------------------------------------------------------------------------------------------------------
             ------------
  91          //  @brief      内部调用，用户无需关心
  92          //  @param      void        
  93          //  @return             
  94          //  @since      v1.0
  95          //  Sample usage:               
  96          //--------------------------------------------------------------------------------------------------------
             ------------
  97          void oled_wrcmd(uint8 cmd)
  98          {
  99   1        uint8 i=8;
 100   1          
 101   1        OLED_CS(0); //使能信号端，拉低时正常使用
 102   1        OLED_DC(0);
 103   1        OLED_SCL(0);;
 104   1        
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 3   

 105   1        while(i--)
 106   1        {
 107   2          if(cmd&0x80){OLED_SDA(1);}
 108   2          else{OLED_SDA(0);}
 109   2          OLED_SCL(1);
 110   2          
 111   2          OLED_SCL(0);
 112   2          cmd<<=1;
 113   2        }
 114   1          OLED_CS(1); //使能信号端，拉低时正常使用
 115   1      }
 116          
 117          //--------------------------------------------------------------------------------------------------------
             ------------
 118          //  @brief      内部调用，用户无需关心
 119          //  @param      void        
 120          //  @return             
 121          //  @since      v1.0
 122          //  Sample usage:               
 123          //--------------------------------------------------------------------------------------------------------
             ------------
 124          void oled_hexascii(uint16 hex,int8 * Print)
 125          {
 126   1        uint8 hexcheck ;
 127   1        uint8 TEMP ;
 128   1        TEMP = 6 ;
 129   1        Print[TEMP ]='\0';
 130   1        while(TEMP)
 131   1        {
 132   2            TEMP -- ;
 133   2            hexcheck  =  hex%10 ;
 134   2            hex   /=10 ;
 135   2            Print[TEMP ]  = hexcheck + 0x30 ;
 136   2        }
 137   1        
 138   1      }
 139          
 140          //--------------------------------------------------------------------------------------------------------
             ------------
 141          //  @brief      OLED初始化函数
 142          //  @param      NULL
 143          //  @return     void
 144          //  @since      v1.0
 145          //  Sample usage:     
 146          //--------------------------------------------------------------------------------------------------------
             ------------
 147          void oled_init(void)
 148          {
 149   1        
 150   1          OLED_CS(1);
 151   1        OLED_SCL(1);
 152   1        
 153   1        OLED_RST(0);
 154   1        delay_ms(50);
 155   1        OLED_RST(1);
 156   1        
 157   1        oled_wrcmd(0xae);//--turn off oled panel
 158   1        oled_wrcmd(0x00);//---set low column address
 159   1        oled_wrcmd(0x10);//---set high column address
 160   1        oled_wrcmd(0x40);//--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
 161   1        oled_wrcmd(0x81);//--set contrast control register
 162   1        oled_wrcmd(Brightness); // Set SEG Output Current Brightness
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 4   

 163   1          
 164   1      #if (0 == OLED_DISPLAY_DIR)
 165   1        oled_wrcmd(0xa1);//--Set SEG/Column Mapping     0xa0左右反置 0xa1正常
 166   1        oled_wrcmd(0xc8);//Set COM/Row Scan Direction   0xc0上下反置 0xc8正常
 167   1      #else
                  oled_wrcmd(0xa0);//--Set SEG/Column Mapping     0xa0左右反置 0xa1正常
                oled_wrcmd(0xc0);//Set COM/Row Scan Direction   0xc0上下反置 0xc8正常
              #endif
 171   1          
 172   1        oled_wrcmd(0xa6);//--set normal display
 173   1        oled_wrcmd(0xa8);//--set multiplex ratio(1 to 64)
 174   1        oled_wrcmd(0x3f);//--1/64 duty
 175   1        oled_wrcmd(0xd3);//-set display offset  Shift Mapping RAM Counter (0x00~0x3F)
 176   1        oled_wrcmd(0x00);//-not offset
 177   1        oled_wrcmd(0xd5);//--set display clock divide ratio/oscillator frequency
 178   1        oled_wrcmd(0x80);//--set divide ratio, Set Clock as 100 Frames/Sec
 179   1        oled_wrcmd(0xd9);//--set pre-charge period
 180   1        oled_wrcmd(0xf1);//Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
 181   1        oled_wrcmd(0xda);//--set com pins hardware configuration
 182   1        oled_wrcmd(0x12);
 183   1        oled_wrcmd(0xdb);//--set vcomh
 184   1        oled_wrcmd(0x40);//Set VCOM Deselect Level
 185   1        oled_wrcmd(0x20);//-Set Page Addressing Mode (0x00/0x01/0x02)
 186   1        oled_wrcmd(0x02);//
 187   1        oled_wrcmd(0x8d);//--set Charge Pump enable/disable
 188   1        oled_wrcmd(0x14);//--set(0x10) disable
 189   1        oled_wrcmd(0xa4);// Disable Entire Display On (0xa4/0xa5)
 190   1        oled_wrcmd(0xa6);// Disable Inverse Display On (0xa6/a7)
 191   1        oled_wrcmd(0xaf);//--turn on oled panel
 192   1        oled_fill(0x00);  //初始清屏
 193   1        oled_set_pos(0,0);
 194   1      }
 195          
 196          //--------------------------------------------------------------------------------------------------------
             ------------
 197          //  @brief      OLED显示坐标设置
 198          //  @param      x     x轴坐标设置0-127
 199          //  @param      y           y轴坐标设置0-7
 200          //  @return     void
 201          //  @since      v1.0
 202          //  Sample usage:     
 203          //--------------------------------------------------------------------------------------------------------
             ------------
 204          void oled_set_pos(uint8 x, uint8 y)
 205          {
 206   1      
 207   1          
 208   1          oled_wrcmd(0xb0+y);
 209   1          oled_wrcmd(((x&0xf0)>>4)|0x10);
 210   1          oled_wrcmd((x&0x0f)|0x00);
 211   1      }
 212          
 213          //--------------------------------------------------------------------------------------------------------
             ------------
 214          //  @brief      OLED清屏函数
 215          //  @param      bmp_data  填充颜色选着(0x00 or 0xff)
 216          //  @return     void
 217          //  @since      v1.0
 218          //  Sample usage:     
 219          //--------------------------------------------------------------------------------------------------------
             ------------
 220          void oled_fill(uint8 bmp_data)
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 5   

 221          {
 222   1        uint8 y,x;
 223   1        
 224   1        for(y=0;y<8;y++)
 225   1        {
 226   2          oled_wrcmd(0xb0+y);
 227   2          oled_wrcmd(0x00);
 228   2          oled_wrcmd(0x10);
 229   2          for(x=0;x<X_WIDTH;x++)  oled_wrdat(bmp_data); 
 230   2        }
 231   1      }
 232          
 233          
 234          //--------------------------------------------------------------------------------------------------------
             ------------
 235          //  @brief      OLED控制一个坐标下8个像素的点亮与熄灭
 236          //  @param      x     x轴坐标设置0-127
 237          //  @param      y           y轴坐标设置0-7
 238          //  @return     void
 239          //  @since      v1.0
 240          //  Sample usage:     oled_putpixel(0,0,0xff);//将0,0坐标 8个点全部点亮
 241          //  Sample usage:     oled_putpixel(0,0,0x01);//将0,0坐标 最低位点亮其余7个熄灭
 242          //  @note                   同理可以任意控制一个坐标下8个像素的点亮与熄灭
 243          //--------------------------------------------------------------------------------------------------------
             ------------
 244          void oled_putpixel(uint8 x,uint8 y,uint8 data1)
 245          {
 246   1        oled_set_pos(x,y);
 247   1          oled_wrcmd(0xb0+y);
 248   1        oled_wrcmd(((x&0xf0)>>4)|0x10);
 249   1        oled_wrcmd((x&0x0f)|0x00);
 250   1        oled_wrdat(data1);
 251   1      }
 252          
 253          //--------------------------------------------------------------------------------------------------------
             ------------
 254          //  @brief      OLED关闭一个坐标所有亮点
 255          //  @param      x     x轴坐标设置0-127
 256          //  @param      y           y轴坐标设置0-7
 257          //  @return     void
 258          //  @since      v1.0
 259          //  Sample usage:     
 260          //--------------------------------------------------------------------------------------------------------
             ------------
 261          void oled_clrpixel(uint8 x,uint8 y)
 262          {
 263   1        oled_set_pos(x,y);
 264   1          oled_wrcmd(0xb0+y);
 265   1        oled_wrcmd(((x&0xf0)>>4)|0x10);
 266   1        oled_wrcmd((x&0x0f)|0x00);
 267   1        oled_wrdat(0x00);
 268   1      }
 269          
 270          
 271          //--------------------------------------------------------------------------------------------------------
             ------------
 272          //  @brief      OLED显示字符串(6*8字体)
 273          //  @param      x     x轴坐标设置0-127
 274          //  @param      y           y轴坐标设置0-7
 275          //  @param      ch[]        字符串
 276          //  @return     void
 277          //  @since      v1.0
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 6   

 278          //  Sample usage:     
 279          //--------------------------------------------------------------------------------------------------------
             ------------
 280          void oled_p6x8str(uint8 x,uint8 y,const int8 ch[])
 281          {
 282   1        uint8 c=0,i=0,j=0;
 283   1        while (ch[j]!='\0')
 284   1        {
 285   2            c =ch[j]-32;
 286   2            if(x>126){x=0;y++;}
 287   2            oled_set_pos(x,y);
 288   2            for(i=0;i<6;i++)  oled_wrdat(oled_6x8[c][i]);
 289   2            x+=6;
 290   2            j++;
 291   2        }
 292   1      }
 293          
 294          //--------------------------------------------------------------------------------------------------------
             ------------
 295          //  @brief      OLED显示字符串(8*16字体)
 296          //  @param      x     x轴坐标设置0-127
 297          //  @param      y           y轴坐标设置0-7
 298          //  @param      ch[]        字符串
 299          //  @return     void
 300          //  @since      v1.0
 301          //  Sample usage:     务必注意，本函数字符列高位16，因此y应该是每次递增2
 302          //--------------------------------------------------------------------------------------------------------
             ------------
 303          void oled_p8x16str(uint8 x,uint8 y,const int8 ch[])
 304          {
 305   1        uint8 c=0,i=0,j=0;
 306   1        
 307   1        while (ch[j]!='\0')
 308   1        {
 309   2            c =ch[j]-32;
 310   2            if(x>120){x=0;y++;}
 311   2          
 312   2            oled_set_pos(x,y);
 313   2            for(i=0;i<8;i++)  oled_wrdat(oled_8x16[c*16+i]);
 314   2              
 315   2            oled_set_pos(x,y+1);
 316   2            for(i=0;i<8;i++)  oled_wrdat(oled_8x16[c*16+i+8]);
 317   2              
 318   2            x+=8;
 319   2            j++;
 320   2        }
 321   1      }
 322          
 323          //--------------------------------------------------------------------------------------------------------
             ------------
 324          //  @brief      OLED显示无符号数(6*8字体)
 325          //  @param      x     x轴坐标设置0-127
 326          //  @param      y           y轴坐标设置0-7
 327          //  @param      num         无符号数
 328          //  @return     void
 329          //  @since      v1.0
 330          //  Sample usage:     
 331          //--------------------------------------------------------------------------------------------------------
             ------------
 332          void oled_uint16(uint8 x, uint8 y, uint16 num)
 333          {
 334   1        int8 ch[7];
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 7   

 335   1        
 336   1        oled_hexascii(num,ch);
 337   1          
 338   1          oled_p6x8str(x, y, &ch[1]);     //显示数字  6*8字体
 339   1          //oled_p8x16str(x, y, &ch[1]);  //显示数字  8*16字体
 340   1      }
 341          
 342          //--------------------------------------------------------------------------------------------------------
             ------------
 343          //  @brief      OLED显示有符号数(6*8字体)
 344          //  @param      x     x轴坐标设置0-127
 345          //  @param      y           y轴坐标设置0-7
 346          //  @param      num         有符号数
 347          //  @return     void
 348          //  @since      v1.0
 349          //  Sample usage:     
 350          //--------------------------------------------------------------------------------------------------------
             ------------
 351          void oled_int16(uint8 x, uint8 y, int16 num)
 352          {
 353   1        int8 ch[7];
 354   1        if(num<0)   {num = -num;oled_p6x8str(x, y, "-");}
 355   1        else         oled_p6x8str(x, y, " ");
 356   1        x+=6;       
 357   1          
 358   1        oled_hexascii(num,ch);
 359   1          oled_p6x8str(x, y, &ch[1]);     //显示数字  6*8字体
 360   1      }
 361          
 362          //--------------------------------------------------------------------------------------------------------
             ------------
 363          //  @brief      OLED显示32位有符号(去除整数部分无效的0)
 364          //  @param      x     x轴坐标设置0-127
 365          //  @param      y           y轴坐标设置0-7
 366          //  @param      dat         需要显示的变量，数据类型uint32
 367          //  @param      num         需要显示的位数 最高10位  不包含正负号
 368          //  @return     void
 369          //  @since      v1.0
 370          //  Sample usage:           oled_printf_int32(0,0,x,5);//x可以为int32 uint16 int16 uint8 int8类型
 371          //  Sample usage:           负数会显示一个 ‘-’号   正数显示一个空格
 372          //--------------------------------------------------------------------------------------------------------
             ------------
 373          void oled_printf_int32(uint16 x,uint16 y,int32 dat,uint8 num)
 374          {
 375   1          int8    buff[34];
 376   1          uint8   length;
 377   1          
 378   1          if(10<num)      num = 10;
 379   1          
 380   1          num++;
 381   1          if(0>dat)   length = zf_sprintf( &buff[0],"%d",dat);//负数
 382   1          else
 383   1          {
 384   2              buff[0] = ' ';
 385   2              length = zf_sprintf( &buff[1],"%d",dat);
 386   2              length++;
 387   2          }
 388   1          while(length < num)
 389   1          {
 390   2              buff[length] = ' ';
 391   2              length++;
 392   2          }
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 8   

 393   1          buff[num] = '\0';
 394   1          
 395   1          oled_p6x8str(x, y, buff); //显示数字
 396   1      }
 397          
 398          //--------------------------------------------------------------------------------------------------------
             ------------
 399          //  @brief      OLED显示浮点数(去除整数部分无效的0)
 400          //  @param      x     x轴坐标设置0-127
 401          //  @param      y           y轴坐标设置0-7
 402          //  @param      dat         需要显示的变量，数据类型float或double
 403          //  @param      num         整数位显示长度   最高10位  
 404          //  @param      pointnum    小数位显示长度   最高6位
 405          //  @return     void
 406          //  @since      v1.0
 407          //  Sample usage:           oled_printf_float(0,0,x,2,3);//显示浮点数   整数显示2位   小数显示三位
 408          //  @note                   特别注意当发现小数部分显示的值与你写入的值不一样的时候，
 409          //                          可能是由于浮点数精度丢失问题导致的，这并不是显示函数的问题，
 410          //                          有关问题的详情，请自行百度学习   浮点数精度丢失问题。
 411          //                          负数会显示一个 ‘-’号   正数显示一个空格
 412          //--------------------------------------------------------------------------------------------------------
             ------------
 413          void oled_printf_float(uint16 x,uint16 y,double dat,uint8 num,uint8 pointnum)
 414          {
 415   1          uint8   length;
 416   1        int8    buff[34];
 417   1        int8    start,end,point;
 418   1      
 419   1        if(6<pointnum)  pointnum = 6;
 420   1          if(10<num)      num = 10;
 421   1              
 422   1          if(0>dat)   length = zf_sprintf( &buff[0],"%f",dat);//负数
 423   1          else
 424   1          {
 425   2              length = zf_sprintf( &buff[1],"%f",dat);
 426   2              length++;
 427   2          }
 428   1          point = length - 7;         //计算小数点位置
 429   1          start = point - num - 1;    //计算起始位
 430   1          end = point + pointnum + 1; //计算结束位
 431   1          while(0>start)//整数位不够  末尾应该填充空格
 432   1          {
 433   2              buff[end] = ' ';
 434   2              end++;
 435   2              start++;
 436   2          }
 437   1          
 438   1          if(0>dat)   buff[start] = '-';
 439   1          else        buff[start] = ' ';
 440   1          
 441   1          buff[end] = '\0';
 442   1          
 443   1          oled_p6x8str(x, y, buff); //显示数字
 444   1      }
 445          
 446          
 447          
 448          //--------------------------------------------------------------------------------------------------------
             ------------
 449          //  @brief      OLED显示图像
 450          //  @param      high      图像高度
 451          //  @param      width     图像宽度
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 9   

 452          //  @param      *p        图像地址（数组）
 453          //  @param      value     二值化阀值
 454          //  @return     void
 455          //  @since      v1.0
 456          //  Sample usage: 
 457          //  @Note       使用Image2lcd V3.2软件取模   C语言数组   水平扫描   
 458          //              宽度高度自行设置   颜色反转  256色
 459          //--------------------------------------------------------------------------------------------------------
             ------------
 460          void oled_dis_bmp(uint16 high, uint16 width, uint8 *p,uint8 value)
 461          {
 462   1          int16 i,j;
 463   1          int16 temp,temp1;
 464   1          uint8 dat;
 465   1          
 466   1          
 467   1          temp1 = high%8;
 468   1          if(temp1 == 0) temp = high/8;
 469   1          else           temp = high/8+1;
 470   1      
 471   1          for(i=0; i<temp; i++)
 472   1          {
 473   2              oled_set_pos(0,i);
 474   2              for(j=0; j<width; j++)
 475   2              {
 476   3                  dat = 0;
 477   3                  if( i<(temp-1) || !temp1 || temp1>=1)dat |= (*(p+i*8*width+j+width*0) > value? 1: 0)<<0;
 478   3                  if( i<(temp-1) || !temp1 || temp1>=2)dat |= (*(p+i*8*width+j+width*1) > value? 1: 0)<<1;
 479   3                  if( i<(temp-1) || !temp1 || temp1>=3)dat |= (*(p+i*8*width+j+width*2) > value? 1: 0)<<2;
 480   3                  if( i<(temp-1) || !temp1 || temp1>=4)dat |= (*(p+i*8*width+j+width*3) > value? 1: 0)<<3;
 481   3                  if( i<(temp-1) || !temp1 || temp1>=5)dat |= (*(p+i*8*width+j+width*4) > value? 1: 0)<<4;
 482   3                  if( i<(temp-1) || !temp1 || temp1>=6)dat |= (*(p+i*8*width+j+width*5) > value? 1: 0)<<5;
 483   3                  if( i<(temp-1) || !temp1 || temp1>=7)dat |= (*(p+i*8*width+j+width*6) > value? 1: 0)<<6;
 484   3                  if( i<(temp-1) || !temp1 || temp1>=8)dat |= (*(p+i*8*width+j+width*7) > value? 1: 0)<<7;
 485   3                 
 486   3                  oled_wrdat(dat);
 487   3              }
 488   2          }
 489   1      }
 490          
 491          //--------------------------------------------------------------------------------------------------------
             ------------
 492          //  @brief      汉字显示
 493          //  @param      x       横坐标 0-127
 494          //  @param      y       纵坐标 0-7
 495          //  @param      size    取模的时候设置的汉字字体大小，也就是一个汉字占用的点阵长宽为多少个点，取模的时候需
             -要长宽是一样的。
 496          //  @param      *p      需要显示的汉字数组
 497          //  @param      len     需要显示多少位
 498          //  @return     void
 499          //  @since      v1.0
 500          //  Sample usage:   
 501          //  @Note       使用PCtoLCD2002软件取模       阴码、逐行式、顺向   16*16
 502          //--------------------------------------------------------------------------------------------------------
             ------------
 503          void oled_print_chinese(uint8 x, uint8 y, uint8 size, const uint8 *p, uint8 len)
 504          {
 505   1          int16 i,j,k;
 506   1          
 507   1          for(i=0; i<len; i++)
 508   1          {
 509   2              for(j=0; j<(size/8); j++)
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 10  

 510   2              {
 511   3                  oled_set_pos(x+i*size,y+j);
 512   3                  for(k=0; k<16; k++)
 513   3                  {
 514   4                      oled_wrdat(*p);
 515   4                      p++;
 516   4                  }
 517   3              }
 518   2          }
 519   1      }
 520          
 521          void oled_cls(void)
 522          {
 523   1          unsigned char y,x;  
 524   1          for(y=0;y<8;y++)
 525   1          {
 526   2              oled_wrcmd(0xb0+y);
 527   2              oled_wrcmd(0x01);
 528   2              oled_wrcmd(0x10); 
 529   2              for(x=0;x<X_WIDTH;x++)
 530   2              oled_wrdat(0);
 531   2          }
 532   1      }
 533          
 534          
 535          //--------------------------------------------------------------------------------------------------------
             ------------
 536          //  以下函数是使用硬件SPI通信，相比较软件IIC，速度比软件IIC快。
 537          //--------------------------------------------------------------------------------------------------------
             ------------
 538          
 539          //--------------------------------------------------------------------------------------------------------
             ------------
 540          //  @brief      内部调用，用户无需关心
 541          //  @param      void        
 542          //  @return             
 543          //  @since      v1.0
 544          //  Sample usage:               
 545          //--------------------------------------------------------------------------------------------------------
             ------------
 546          void oled_wrdat_spi(uint8 dat)
 547          {
 548   1          OLED_SPI_CS(0); //使能信号端，拉低时正常使用
 549   1        OLED_SPI_DC(1);
 550   1        spi_mosi(dat);
 551   1          OLED_SPI_CS(1); //使能信号端，拉低时正常使用
 552   1      
 553   1        
 554   1      }
 555          
 556          //--------------------------------------------------------------------------------------------------------
             ------------
 557          //  @brief      内部调用，用户无需关心
 558          //  @param      void        
 559          //  @return             
 560          //  @since      v1.0
 561          //  Sample usage:               
 562          //--------------------------------------------------------------------------------------------------------
             ------------
 563          //void oled_wr6dat_spi(uint8 dat)
 564          //{
 565          //  uint8 i=6;
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 11  

 566          //    
 567          //  OLED_SPI_CS(0); //使能信号端，拉低时正常使用
 568          //  OLED_SPI_DC(1);
 569          //  OLED_SCL(0);
 570          //  while(i--)
 571          //  {
 572          //    if(dat&0x80){OLED_SDA(1);}
 573          //    else{OLED_SDA(0);}
 574          //    OLED_SCL(1);
 575          //    OLED_SCL(0);
 576          //    dat<<=1;
 577          //  }
 578          //    OLED_SPI_CS(1); //使能信号端，拉低时正常使用
 579          //}
 580          
 581          //--------------------------------------------------------------------------------------------------------
             ------------
 582          //  @brief      内部调用，用户无需关心
 583          //  @param      void        
 584          //  @return             
 585          //  @since      v1.0
 586          //  Sample usage:               
 587          //--------------------------------------------------------------------------------------------------------
             ------------
 588          void oled_wrcmd_spi(uint8 cmd)
 589          {
 590   1        OLED_SPI_CS(0); //使能信号端，拉低时正常使用
 591   1        OLED_SPI_DC(0);
 592   1        spi_mosi(cmd);
 593   1          OLED_SPI_CS(1); //使能信号端，拉低时正常使用
 594   1      }
 595          
 596          //--------------------------------------------------------------------------------------------------------
             ------------
 597          //  @brief      内部调用，用户无需关心
 598          //  @param      void        
 599          //  @return             
 600          //  @since      v1.0
 601          //  Sample usage:               
 602          //--------------------------------------------------------------------------------------------------------
             ------------
 603          void oled_hexascii_spi(uint16 hex,int8 * Print)
 604          {
 605   1        uint8 hexcheck ;
 606   1        uint8 TEMP ;
 607   1        TEMP = 6 ;
 608   1        Print[TEMP ]='\0';
 609   1        while(TEMP)
 610   1        {
 611   2            TEMP -- ;
 612   2            hexcheck  =  hex%10 ;
 613   2            hex   /=10 ;
 614   2            Print[TEMP ]  = hexcheck + 0x30 ;
 615   2        }
 616   1        
 617   1      }
 618          
 619          //--------------------------------------------------------------------------------------------------------
             ------------
 620          //  @brief      OLED初始化函数
 621          //  @param      NULL
 622          //  @return     void
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 12  

 623          //  @since      v1.0
 624          //  Sample usage:     
 625          //--------------------------------------------------------------------------------------------------------
             ------------
 626          void oled_init_spi(void)
 627          {
 628   1        
 629   1          OLED_SPI_CS(1);
 630   1        
 631   1          spi_init(OLED_SPI_N, OLED_SPI_SCLK_PIN, OLED_SPI_MOSI_PIN, OLED_SPI_MISO_PIN, 0, MASTER, SPI_SYSclk_DI
             -V_4);
 632   1        
 633   1        OLED_SPI_RST(0);
 634   1        delay_ms(50);
 635   1        OLED_SPI_RST(1);
 636   1        
 637   1        oled_wrcmd_spi(0xae);//--turn off oled panel
 638   1        oled_wrcmd_spi(0x00);//---set low column address
 639   1        oled_wrcmd_spi(0x10);//---set high column address
 640   1        oled_wrcmd_spi(0x40);//--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
 641   1        oled_wrcmd_spi(0x81);//--set contrast control register
 642   1        oled_wrcmd_spi(Brightness); // Set SEG Output Current Brightness
 643   1          
 644   1      #if (0 == OLED_DISPLAY_DIR)
 645   1        oled_wrcmd_spi(0xa1);//--Set SEG/Column Mapping     0xa0左右反置 0xa1正常
 646   1        oled_wrcmd_spi(0xc8);//Set COM/Row Scan Direction   0xc0上下反置 0xc8正常
 647   1      #else
                  oled_wrcmd_spi(0xa0);//--Set SEG/Column Mapping     0xa0左右反置 0xa1正常
                oled_wrcmd_spi(0xc0);//Set COM/Row Scan Direction   0xc0上下反置 0xc8正常
              #endif
 651   1          
 652   1        oled_wrcmd_spi(0xa6);//--set normal display
 653   1        oled_wrcmd_spi(0xa8);//--set multiplex ratio(1 to 64)
 654   1        oled_wrcmd_spi(0x3f);//--1/64 duty
 655   1        oled_wrcmd_spi(0xd3);//-set display offset  Shift Mapping RAM Counter (0x00~0x3F)
 656   1        oled_wrcmd_spi(0x00);//-not offset
 657   1        oled_wrcmd_spi(0xd5);//--set display clock divide ratio/oscillator frequency
 658   1        oled_wrcmd_spi(0x80);//--set divide ratio, Set Clock as 100 Frames/Sec
 659   1        oled_wrcmd_spi(0xd9);//--set pre-charge period
 660   1        oled_wrcmd_spi(0xf1);//Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
 661   1        oled_wrcmd_spi(0xda);//--set com pins hardware configuration
 662   1        oled_wrcmd_spi(0x12);
 663   1        oled_wrcmd_spi(0xdb);//--set vcomh
 664   1        oled_wrcmd_spi(0x40);//Set VCOM Deselect Level
 665   1        oled_wrcmd_spi(0x20);//-Set Page Addressing Mode (0x00/0x01/0x02)
 666   1        oled_wrcmd_spi(0x02);//
 667   1        oled_wrcmd_spi(0x8d);//--set Charge Pump enable/disable
 668   1        oled_wrcmd_spi(0x14);//--set(0x10) disable
 669   1        oled_wrcmd_spi(0xa4);// Disable Entire Display On (0xa4/0xa5)
 670   1        oled_wrcmd_spi(0xa6);// Disable Inverse Display On (0xa6/a7)
 671   1        oled_wrcmd_spi(0xaf);//--turn on oled panel
 672   1        oled_fill_spi(0x00);  //初始清屏
 673   1        oled_set_pos_spi(0,0);
 674   1      }
 675          
 676          //--------------------------------------------------------------------------------------------------------
             ------------
 677          //  @brief      OLED显示坐标设置
 678          //  @param      x     x轴坐标设置0-127
 679          //  @param      y           y轴坐标设置0-7
 680          //  @return     void
 681          //  @since      v1.0
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 13  

 682          //  Sample usage:     
 683          //--------------------------------------------------------------------------------------------------------
             ------------
 684          void oled_set_pos_spi(uint8 x, uint8 y)
 685          {
 686   1      
 687   1          
 688   1          oled_wrcmd_spi(0xb0+y);
 689   1          oled_wrcmd_spi(((x&0xf0)>>4)|0x10);
 690   1          oled_wrcmd_spi((x&0x0f)|0x00);
 691   1      }
 692          
 693          //--------------------------------------------------------------------------------------------------------
             ------------
 694          //  @brief      OLED清屏函数
 695          //  @param      bmp_data  填充颜色选着(0x00 or 0xff)
 696          //  @return     void
 697          //  @since      v1.0
 698          //  Sample usage:     
 699          //--------------------------------------------------------------------------------------------------------
             ------------
 700          void oled_fill_spi(uint8 bmp_data)
 701          {
 702   1        uint8 y,x;
 703   1        
 704   1        for(y=0;y<8;y++)
 705   1        {
 706   2          oled_wrcmd_spi(0xb0+y);
 707   2          oled_wrcmd_spi(0x01);
 708   2          oled_wrcmd_spi(0x10);
 709   2          for(x=0;x<X_WIDTH;x++)  oled_wrdat_spi(bmp_data); 
 710   2        }
 711   1      }
 712          
 713          
 714          //--------------------------------------------------------------------------------------------------------
             ------------
 715          //  @brief      OLED控制一个坐标下8个像素的点亮与熄灭
 716          //  @param      x     x轴坐标设置0-127
 717          //  @param      y           y轴坐标设置0-7
 718          //  @return     void
 719          //  @since      v1.0
 720          //  Sample usage:     oled_putpixel(0,0,0xff);//将0,0坐标 8个点全部点亮
 721          //  Sample usage:     oled_putpixel(0,0,0x01);//将0,0坐标 最低位点亮其余7个熄灭
 722          //  @note                   同理可以任意控制一个坐标下8个像素的点亮与熄灭
 723          //--------------------------------------------------------------------------------------------------------
             ------------
 724          void oled_putpixel_spi(uint8 x,uint8 y,uint8 data1)
 725          {
 726   1        oled_set_pos_spi(x,y);
 727   1          oled_wrcmd_spi(0xb0+y);
 728   1        oled_wrcmd_spi(((x&0xf0)>>4)|0x10);
 729   1        oled_wrcmd_spi((x&0x0f)|0x00);
 730   1        oled_wrdat_spi(data1);
 731   1      }
 732          
 733          //--------------------------------------------------------------------------------------------------------
             ------------
 734          //  @brief      OLED关闭一个坐标所有亮点
 735          //  @param      x     x轴坐标设置0-127
 736          //  @param      y           y轴坐标设置0-7
 737          //  @return     void
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 14  

 738          //  @since      v1.0
 739          //  Sample usage:     
 740          //--------------------------------------------------------------------------------------------------------
             ------------
 741          void oled_clrpixel_spi(uint8 x,uint8 y)
 742          {
 743   1        oled_set_pos_spi(x,y);
 744   1          oled_wrcmd_spi(0xb0+y);
 745   1        oled_wrcmd_spi(((x&0xf0)>>4)|0x10);
 746   1        oled_wrcmd_spi((x&0x0f)|0x00);
 747   1        oled_wrdat_spi(0x00);
 748   1      }
 749          
 750          
 751          //--------------------------------------------------------------------------------------------------------
             ------------
 752          //  @brief      OLED显示字符串(6*8字体)
 753          //  @param      x     x轴坐标设置0-127
 754          //  @param      y           y轴坐标设置0-7
 755          //  @param      ch[]        字符串
 756          //  @return     void
 757          //  @since      v1.0
 758          //  Sample usage:     
 759          //--------------------------------------------------------------------------------------------------------
             ------------
 760          void oled_p6x8str_spi(uint8 x,uint8 y,const int8 ch[])
 761          {
 762   1        uint8 c=0,i=0,j=0;
 763   1        while (ch[j]!='\0')
 764   1        {
 765   2            c =ch[j]-32;
 766   2            if(x>126){x=0;y++;}
 767   2            oled_set_pos_spi(x,y);
 768   2            for(i=0;i<6;i++)  oled_wrdat_spi(oled_6x8[c][i]);
 769   2            x+=6;
 770   2            j++;
 771   2        }
 772   1      }
 773          
 774          //--------------------------------------------------------------------------------------------------------
             ------------
 775          //  @brief      OLED显示字符串(8*16字体)
 776          //  @param      x     x轴坐标设置0-127
 777          //  @param      y           y轴坐标设置0-7
 778          //  @param      ch[]        字符串
 779          //  @return     void
 780          //  @since      v1.0
 781          //  Sample usage:     务必注意，本函数字符列高位16，因此y应该是每次递增2
 782          //--------------------------------------------------------------------------------------------------------
             ------------
 783          void oled_p8x16str_spi(uint8 x,uint8 y,const int8 ch[])
 784          {
 785   1        uint8 c=0,i=0,j=0;
 786   1        
 787   1        while (ch[j]!='\0')
 788   1        {
 789   2            c =ch[j]-32;
 790   2            if(x>120){x=0;y++;}
 791   2          
 792   2            oled_set_pos_spi(x,y);
 793   2            for(i=0;i<8;i++)  oled_wrdat_spi(oled_8x16[c*16+i]);
 794   2              
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 15  

 795   2            oled_set_pos_spi(x,y+1);
 796   2            for(i=0;i<8;i++)  oled_wrdat_spi(oled_8x16[c*16+i+8]);
 797   2              
 798   2            x+=8;
 799   2            j++;
 800   2        }
 801   1      }
 802          
 803          //--------------------------------------------------------------------------------------------------------
             ------------
 804          //  @brief      OLED显示无符号数(6*8字体)
 805          //  @param      x     x轴坐标设置0-127
 806          //  @param      y           y轴坐标设置0-7
 807          //  @param      num         无符号数
 808          //  @return     void
 809          //  @since      v1.0
 810          //  Sample usage:     
 811          //--------------------------------------------------------------------------------------------------------
             ------------
 812          void oled_uint16_spi(uint8 x, uint8 y, uint16 num)
 813          {
 814   1        int8 ch[7];
 815   1        
 816   1        oled_hexascii_spi(num,ch);
 817   1          
 818   1          oled_p6x8str_spi(x, y, &ch[1]);     //显示数字  6*8字体
 819   1          //oled_p8x16str(x, y, &ch[1]);  //显示数字  8*16字体
 820   1      }
 821          
 822          //--------------------------------------------------------------------------------------------------------
             ------------
 823          //  @brief      OLED显示有符号数(6*8字体)
 824          //  @param      x     x轴坐标设置0-127
 825          //  @param      y           y轴坐标设置0-7
 826          //  @param      num         有符号数
 827          //  @return     void
 828          //  @since      v1.0
 829          //  Sample usage:     
 830          //--------------------------------------------------------------------------------------------------------
             ------------
 831          void oled_int16_spi(uint8 x, uint8 y, int16 num)
 832          {
 833   1        int8 ch[7];
 834   1        if(num<0)   {num = -num;oled_p6x8str_spi(x, y, "-");}
 835   1        else         oled_p6x8str_spi(x, y, " ");
 836   1        x+=6;       
 837   1          
 838   1        oled_hexascii_spi(num,ch);
 839   1          oled_p6x8str_spi(x, y, &ch[1]);     //显示数字  6*8字体
 840   1      }
 841          
 842          //--------------------------------------------------------------------------------------------------------
             ------------
 843          //  @brief      OLED显示32位有符号(去除整数部分无效的0)
 844          //  @param      x     x轴坐标设置0-127
 845          //  @param      y           y轴坐标设置0-7
 846          //  @param      dat         需要显示的变量，数据类型uint32
 847          //  @param      num         需要显示的位数 最高10位  不包含正负号
 848          //  @return     void
 849          //  @since      v1.0
 850          //  Sample usage:           oled_printf_int32(0,0,x,5);//x可以为int32 uint16 int16 uint8 int8类型
 851          //  Sample usage:           负数会显示一个 ‘-’号   正数显示一个空格
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 16  

 852          //--------------------------------------------------------------------------------------------------------
             ------------
 853          void oled_printf_int32_spi(uint16 x,uint16 y,int32 dat,uint8 num)
 854          {
 855   1          int8    buff[34];
 856   1          uint8   length;
 857   1          
 858   1          if(10<num)      num = 10;
 859   1          
 860   1          num++;
 861   1          if(0>dat)   length = zf_sprintf( &buff[0],"%d",dat);//负数
 862   1          else
 863   1          {
 864   2              buff[0] = ' ';
 865   2              length = zf_sprintf( &buff[1],"%d",dat);
 866   2              length++;
 867   2          }
 868   1          while(length < num)
 869   1          {
 870   2              buff[length] = ' ';
 871   2              length++;
 872   2          }
 873   1          buff[num] = '\0';
 874   1          
 875   1          oled_p6x8str_spi(x, y, buff); //显示数字
 876   1      }
 877          
 878          //--------------------------------------------------------------------------------------------------------
             ------------
 879          //  @brief      OLED显示浮点数(去除整数部分无效的0)
 880          //  @param      x     x轴坐标设置0-127
 881          //  @param      y           y轴坐标设置0-7
 882          //  @param      dat         需要显示的变量，数据类型float或double
 883          //  @param      num         整数位显示长度   最高10位  
 884          //  @param      pointnum    小数位显示长度   最高6位
 885          //  @return     void
 886          //  @since      v1.0
 887          //  Sample usage:           oled_printf_float(0,0,x,2,3);//显示浮点数   整数显示2位   小数显示三位
 888          //  @note                   特别注意当发现小数部分显示的值与你写入的值不一样的时候，
 889          //                          可能是由于浮点数精度丢失问题导致的，这并不是显示函数的问题，
 890          //                          有关问题的详情，请自行百度学习   浮点数精度丢失问题。
 891          //                          负数会显示一个 ‘-’号   正数显示一个空格
 892          //--------------------------------------------------------------------------------------------------------
             ------------
 893          void oled_printf_float_spi(uint16 x,uint16 y,double dat,uint8 num,uint8 pointnum)
 894          {
 895   1          uint8   length;
 896   1        int8    buff[34];
 897   1        int8    start,end,point;
 898   1      
 899   1        if(6<pointnum)  pointnum = 6;
 900   1          if(10<num)      num = 10;
 901   1              
 902   1          if(0>dat)   length = zf_sprintf( &buff[0],"%f",dat);//负数
 903   1          else
 904   1          {
 905   2              length = zf_sprintf( &buff[1],"%f",dat);
 906   2              length++;
 907   2          }
 908   1          point = length - 7;         //计算小数点位置
 909   1          start = point - num - 1;    //计算起始位
 910   1          end = point + pointnum + 1; //计算结束位
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 17  

 911   1          while(0>start)//整数位不够  末尾应该填充空格
 912   1          {
 913   2              buff[end] = ' ';
 914   2              end++;
 915   2              start++;
 916   2          }
 917   1          
 918   1          if(0>dat)   buff[start] = '-';
 919   1          else        buff[start] = ' ';
 920   1          
 921   1          buff[end] = '\0';
 922   1          
 923   1          oled_p6x8str_spi(x, y, buff); //显示数字
 924   1      }
 925          
 926          
 927          
 928          //--------------------------------------------------------------------------------------------------------
             ------------
 929          //  @brief      OLED显示图像
 930          //  @param      high      图像高度
 931          //  @param      width     图像宽度
 932          //  @param      *p        图像地址（数组）
 933          //  @param      value     二值化阀值
 934          //  @return     void
 935          //  @since      v1.0
 936          //  Sample usage: 
 937          //  @Note       使用Image2lcd V3.2软件取模   C语言数组   水平扫描   
 938          //              宽度高度自行设置   颜色反转  256色
 939          //--------------------------------------------------------------------------------------------------------
             ------------
 940          void oled_dis_bmp_spi(uint16 high, uint16 width, uint8 *p,uint8 value)
 941          {
 942   1          int16 i,j;
 943   1          int16 temp,temp1;
 944   1          uint8 dat;
 945   1          
 946   1          
 947   1          temp1 = high%8;
 948   1          if(temp1 == 0) temp = high/8;
 949   1          else           temp = high/8+1;
 950   1      
 951   1          for(i=0; i<temp; i++)
 952   1          {
 953   2              oled_set_pos_spi(0,i);
 954   2              for(j=0; j<width; j++)
 955   2              {
 956   3                  dat = 0;
 957   3                  if( i<(temp-1) || !temp1 || temp1>=1)dat |= (*(p+i*8*width+j+width*0) > value? 1: 0)<<0;
 958   3                  if( i<(temp-1) || !temp1 || temp1>=2)dat |= (*(p+i*8*width+j+width*1) > value? 1: 0)<<1;
 959   3                  if( i<(temp-1) || !temp1 || temp1>=3)dat |= (*(p+i*8*width+j+width*2) > value? 1: 0)<<2;
 960   3                  if( i<(temp-1) || !temp1 || temp1>=4)dat |= (*(p+i*8*width+j+width*3) > value? 1: 0)<<3;
 961   3                  if( i<(temp-1) || !temp1 || temp1>=5)dat |= (*(p+i*8*width+j+width*4) > value? 1: 0)<<4;
 962   3                  if( i<(temp-1) || !temp1 || temp1>=6)dat |= (*(p+i*8*width+j+width*5) > value? 1: 0)<<5;
 963   3                  if( i<(temp-1) || !temp1 || temp1>=7)dat |= (*(p+i*8*width+j+width*6) > value? 1: 0)<<6;
 964   3                  if( i<(temp-1) || !temp1 || temp1>=8)dat |= (*(p+i*8*width+j+width*7) > value? 1: 0)<<7;
 965   3                 
 966   3                  oled_wrdat_spi(dat);
 967   3              }
 968   2          }
 969   1      }
 970          
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 18  

 971          //--------------------------------------------------------------------------------------------------------
             ------------
 972          //  @brief      汉字显示
 973          //  @param      x       横坐标 0-127
 974          //  @param      y       纵坐标 0-7
 975          //  @param      size    取模的时候设置的汉字字体大小，也就是一个汉字占用的点阵长宽为多少个点，取模的时候需
             -要长宽是一样的。
 976          //  @param      *p      需要显示的汉字数组
 977          //  @param      len     需要显示多少位
 978          //  @return     void
 979          //  @since      v1.0
 980          //  Sample usage:   
 981          //  @Note       使用PCtoLCD2002软件取模       阴码、逐行式、顺向   16*16
 982          //--------------------------------------------------------------------------------------------------------
             ------------
 983          void oled_print_chinese_spi(uint8 x, uint8 y, uint8 size, const uint8 *p, uint8 len)
 984          {
 985   1          int16 i,j,k;
 986   1          
 987   1          for(i=0; i<len; i++)
 988   1          {
 989   2              for(j=0; j<(size/8); j++)
 990   2              {
 991   3                  oled_set_pos_spi(x+i*size,y+j);
 992   3                  for(k=0; k<16; k++)
 993   3                  {
 994   4                      oled_wrdat_spi(*p);
 995   4                      p++;
 996   4                  }
 997   3              }
 998   2          }
 999   1      }
1000          
1001          #include "stdio.h"
1002          void oled_p6x8num(uint8 x,uint8 y,uint16 num)
1003          {
1004   1        uint8 tmp[6],i;
1005   1        tmp[5]=0;
1006   1        tmp[4]=(uint8)(num%10+0x30);
1007   1        tmp[3]=(uint8)(num/10%10+0x30);
1008   1        tmp[2]=(uint8)(num/100%10+0x30);
1009   1        tmp[1]=(uint8)(num/1000%10+0x30);
1010   1        tmp[0]=(uint8)(num/10000%10+0x30);
1011   1        
1012   1        for(i=0;i<4;i++)
1013   1        {
1014   2          if(tmp[i]=='0')
1015   2            tmp[i]=' ';
1016   2          else
1017   2            break;
1018   2        }
1019   1        oled_p6x8str(x,y,tmp);
1020   1      //   char mytxt[50];
1021   1      //   sprintf(mytxt,"%5d",num);
1022   1      //   oled_p6x8str(x,y,(unsigned char *)mytxt);
1023   1      }
1024          
1025          
1026          void oled_p6x8float(uint8 x,uint8 y,float num)
1027          {
1028   1         int num2,num3;
1029   1         char mytxt[50];
C51 COMPILER V9.00   SEEKFREE_OLED                                                         05/18/2022 20:21:35 PAGE 19  

1030   1         uint8 sign=1;
1031   1         if(num<0)
1032   1         {
1033   2            sign=-1;
1034   2            num=-num;
1035   2         }
1036   1         num3=(int)num;
1037   1         num2=(int)(num*10);
1038   1         
1039   1         num2=num2%10;
1040   1         if(sign==-1)
1041   1         {
1042   2            sprintf(mytxt,"-%2d.%d",num3,num2);
1043   2         }
1044   1         else if(sign==1)
1045   1         {
1046   2            sprintf(mytxt,"%3d.%d",num3,num2);
1047   2         }
1048   1         oled_p6x8str(x,y,(unsigned char *)mytxt);
1049   1      }
1050          
1051          void oled_p6x8str_inv(uint8 x,uint8 y,uint8 ch[])
1052          {
1053   1        uint8 c=0,i=0,j=0;      
1054   1        while (ch[j]!='\0')
1055   1        {
1056   2          c =ch[j]-32;
1057   2          if(x>126){x=0;y++;}
1058   2          oled_set_pos(x,y);    
1059   2          for(i=0;i<6;i++)     
1060   2            oled_wrdat(~oled_6x8[c][i]);  
1061   2          x+=6;
1062   2          j++;
1063   2        }
1064   1      }
1065          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   7108    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =   ----     411
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
